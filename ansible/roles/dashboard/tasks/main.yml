
- name: Install docker compose
  get_url: 
    url: https://github.com/docker/compose/releases/download/1.8.0/docker-compose-{{ ansible_system }}-{{ ansible_userspace_architecture }}
    dest: /usr/bin/docker-compose
    mode: 0755
  become: true

- name: Create dashboard folder
  file: path=~/dashboard state=directory

- name: Copy files to host
  copy: src=dashboard dest=~/dashboard

- name: Update ES url for kibana
  lineinfile: 
    dest=~/dashboard/dashboard/lib/config/kibana/kibana.yml 
    regexp='(elasticsearch.* \"http.*)$' 
    line="elasticsearch.url':' \"http://{{ consul_es_service }}.service.consul:9200\" " state=present

- name: Compose the dashboard
  shell: cd ~/dashboard/dashboard/lib && docker-compose -f docker-compose-va-cd.yml up -d
